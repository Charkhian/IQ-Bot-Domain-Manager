<h3 class="sub-header">IQ Bot Connection Settings</h3> 
<form>
	
		<div class="form-group">
  			<label for="usr">IQ Bot Login:</label>
  			<input type="text" class="input-lg form-control" id="iqbotlogin">
	    </div>

		<div class="form-group">
			<label for="pwd">IQ Bot Password:</label>
			<input type="password" class="form-control" id="iqbotpassword">
		</div>

		<div class="form-group">
  			<label for="pwd">IQ Bot URL (with Port):</label>
  			<input type="text" class="form-control form-control-lg" id="iqboturl">
		</div>

		<div class="form-group">
  			<label for="pwd">IQ Bot Version:</label>
   			<button  id="dropdown_title"  class="btn dropdown-toggle" data-toggle="dropdown">5 <span class="caret"></span></button>
                <ul ID="testid" class="dropdown-menu">
                  <li><a href="#">5 </a></li>
                  <li><a href="#">6 </a></li>
                </ul>
		</div>

		<div class="form-group">
			<label for="pwd"> </label>
			<button id="savebutton" type="button" class="btn btn-info btn-xlarge">Save</button>
			<button id="testbutton" type="button" class="btn btn-info btn-xlarge">Test</button>
		</div>

		<div class="form-group">
		<h5>Status:  <span id="status" class="badge badge-secondary">Undetermined</span></h5>

		</div>

  
</form>



<script>

setSocketListeners();

$(this).ready(function(){

	//$('.dropdown-toggle').dropdown();

	$('#savebutton').on('click', function() {
		console.log("save button was clicked");
	    //TO DO - Save info to backend JSON file
	    
	});

	$('#testid li').on('click', function() {
	    $('#dropdown_title').html($(this).find('a').html());
	});

	$('#savebutton').on('click', function() {
	    socket.emit('save_structure',
	    	{
  				"url": $('#iqboturl').val(),
  				"major_version": $('#dropdown_title').text(),
  				"login": $('#iqbotlogin').val(),
  				"password": $('#iqbotpassword').val()
			}
		);
	});

	$('#testbutton').on('click', function() {
		console.log("Sending event");
		socket.emit('test_iqbot_connection',
	    	{}
		);
	});


	socket.emit('get_structure',{});
	console.log("Loaded!");


	});

function setSocketListeners(){

	// On receiving the content of the JSON file, we update all labels
	socket.on('structure_sent',function(result){

		$('#iqbotlogin').val(result["login"]);
		$('#iqbotpassword').val(result["password"]);
		$('#iqboturl').val(result["url"]);

		//$('#iqbotlogin').text(result["login"]);

	});

	socket.on('auth_response',function(result){

		console.log(result);

		//var IsOK = JSON.parse(result);
		var IsOK = JSON.parse(result);

		if(IsOK['success']){
			console.log("OK!");
			//$('#connOK').show()
			$('#status').removeClass('badge-secondary');
			$('#status').removeClass('badge-warning');
			//$('#status').removeClass('badge-success');
			$('#status').text('Connection OK');
			$('#status').addClass('badge-success');

		}else{
			console.log("error!");
			$('#status').removeClass('badge-secondary');
			//$('#status').removeClass('badge-danger');
			$('#status').removeClass('badge-success');
			$('#status').text('Connection Failed');
			$('#status').addClass('badge-warning');
		}
		//
		

		//$('#iqbotlogin').text(result["login"]);

	});

};

</script>

